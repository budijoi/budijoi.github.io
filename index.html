<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joi Ai Apps</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleUp { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .animate-scale-up { animation: scaleUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="min-h-screen font-sans bg-slate-950 text-white overflow-x-hidden">

    <div id="root"></div>

    <script type="module">
        // --- KONFIGURASI FIREBASE ---
        // PENTING: Ganti isi variabel ini dengan config dari Firebase Console Anda!
        const firebaseConfig = {
            apiKey: "API_KEY_ANDA_DISINI",
            authDomain: "PROJECT_ID.firebaseapp.com",
            projectId: "PROJECT_ID",
            storageBucket: "PROJECT_ID.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID"
        };
        
        const appId = 'default-app-id'; // Sesuaikan jika perlu

        // Import module Firebase dari CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Inisialisasi Firebase (Safe Check)
        let app, auth, db;
        let isFirebaseActive = false;
        try {
            if (firebaseConfig.apiKey !== "API_KEY_ANDA_DISINI") {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                isFirebaseActive = true;
            } else {
                console.warn("Firebase Config belum diisi. Menggunakan mode Offline/Demo.");
            }
        } catch (e) {
            console.error("Firebase Error:", e);
        }

        // --- DATA CONSTANTS ---
        const DEFAULT_LINKS = [
            { id: 3, title: 'Free Editor', url: 'https://s.id/2mlDG', category: 'AI Tools', description: 'Edit dan ubah foto kamu jadi lebih keren.' },
            { id: 4, title: 'UMKM Editor', url: 'https://s.id/umkmedit', category: 'AI Tools', description: 'Ubah foto produkmu jadi lebih keren.' },
            { id: 5, title: 'Prompt Generator', url: 'https://s.id/sJUl8', category: 'AI Tools', description: 'Deskripsikan sebuah gambar menjadi prompt siap pakai.' },
            { id: 6, title: 'PAS Foto Generator', url: 'https://s.id/H2Cpn', category: 'Tools', description: 'Ubah foto kamu jadi sebuah PAS Foto siap pakai.' },
            { id: 7, title: 'Voice Generator', url: 'https://s.id/gRpsK', category: 'AI Tools', description: 'Ubah teks menjadi voice dengan banyak pilihan suara dan hasil yang sangat natural.' },
            { id: 8, title: 'Instan Foto', url: 'https://s.id/ClF2y', category: 'AI Tools', description: 'Edit Foto Instan, Cocok Buat Kaum Rebahan.' },
            { id: 9, title: 'Restorasi', url: 'https://s.id/d9K6w', category: 'AI Tools', description: 'Foto Restorasi, Bikin Foto Lama atau Rusak Jadi Bening.' },
            { id: 10, title: 'BarKom', url: 'https://s.id/hUxOT', category: 'AI Tools', description: 'Ubah Gambarmu Menjadi Komik Secara Instan.' },
        ];

        const CONTACT_WA = "6287784183394";
        const DANA_NUMBER = "085323073037";

        const THEMES = {
            techno: {
                label: 'Techno',
                bgClass: 'bg-slate-950',
                textMain: 'text-white',
                textSub: 'text-slate-400',
                cardClass: 'bg-slate-800/60 backdrop-blur-sm border-slate-700/50 hover:bg-slate-800 hover:border-blue-500/30',
                btnPrimary: 'bg-blue-600 hover:bg-blue-500 text-white',
                headerIconBg: 'bg-slate-800/50 border-slate-700/50',
                bottomNav: 'bg-slate-900/90 border-slate-700 text-slate-300',
                accentColor: 'text-blue-400',
                iconBg: 'bg-slate-900 border-slate-700 text-blue-400',
                modalBg: 'bg-slate-900 border-slate-700 text-white'
            },
            modern: {
                label: 'Modern',
                bgClass: 'bg-gradient-to-br from-indigo-900 via-purple-900 to-fuchsia-900',
                textMain: 'text-white',
                textSub: 'text-purple-200',
                cardClass: 'bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/20 hover:border-white/30',
                btnPrimary: 'bg-fuchsia-600 hover:bg-fuchsia-500 text-white shadow-lg shadow-fuchsia-900/20',
                headerIconBg: 'bg-white/10 border-white/10',
                bottomNav: 'bg-black/40 backdrop-blur-xl border-white/10 text-white',
                accentColor: 'text-fuchsia-300',
                iconBg: 'bg-white/10 border-white/10 text-fuchsia-300',
                modalBg: 'bg-slate-900/90 backdrop-blur-xl border-white/10 text-white'
            },
            simple: {
                label: 'Simple',
                bgClass: 'bg-gray-100',
                textMain: 'text-slate-800',
                textSub: 'text-slate-500',
                cardClass: 'bg-white border-gray-200 shadow-sm hover:shadow-md hover:-translate-y-0.5',
                btnPrimary: 'bg-slate-800 hover:bg-slate-900 text-white',
                headerIconBg: 'bg-white border-gray-200',
                bottomNav: 'bg-white/90 border-gray-200 text-slate-600',
                accentColor: 'text-slate-700',
                iconBg: 'bg-gray-50 border-gray-200 text-slate-600',
                modalBg: 'bg-white border-gray-200 text-slate-800'
            },
            minimalis: {
                label: 'Minimalis',
                bgClass: 'bg-white',
                textMain: 'text-black',
                textSub: 'text-gray-500',
                cardClass: 'bg-white border-2 border-black hover:bg-black hover:text-white group-hover:text-white transition-colors',
                btnPrimary: 'bg-black hover:bg-gray-800 text-white rounded-none',
                headerIconBg: 'bg-white border-2 border-black',
                bottomNav: 'bg-white border-t-2 border-black text-black',
                accentColor: 'text-black',
                iconBg: 'bg-white border-2 border-black text-black',
                modalBg: 'bg-white border-2 border-black text-black rounded-none'
            }
        };

        // --- STATE MANAGEMENT ---
        // Kita menggunakan objek global "state" untuk meniru React State
        const state = {
            user: null,
            links: [...DEFAULT_LINKS],
            currentTheme: 'modern',
            webTitle: 'Joi Ai Apps',
            webDesc: '100% Gratis',
            isAdmin: false,
            showLogin: false,
            showWarning: true,
            showSuggestion: false,
            showDonation: false,
            linkToDelete: null,
            editingLink: null,
            
            // Form Inputs
            forms: {
                username: '',
                password: '',
                newLinkTitle: '',
                newLinkUrl: '',
                newLinkDesc: '',
                suggName: '',
                suggContent: '',
                donationAmount: ''
            }
        };

        // --- HELPER FUNCTIONS ---
        
        // 1. Render App (Main Loop)
        function render() {
            const root = document.getElementById('root');
            const theme = THEMES[state.currentTheme] || THEMES.techno;

            // HTML Structure
            root.innerHTML = `
                <div class="min-h-screen font-sans ${theme.bgClass} relative flex flex-col items-center overflow-x-hidden transition-colors duration-500">
                    
                    <canvas id="networkCanvas" class="${state.currentTheme === 'techno' ? 'fixed inset-0 bg-slate-950 z-0' : 'hidden'}"></canvas>

                    ${state.currentTheme === 'techno' ? 
                        '<div class="fixed inset-0 bg-gradient-to-b from-slate-950/80 via-slate-900/60 to-slate-950 pointer-events-none z-0"></div>' 
                        : ''}

                    <div class="relative z-10 w-full max-w-lg px-6 pt-12 pb-8 flex flex-col items-center animate-fade-in">
                        <button onclick="handlers.toggleAdmin()" 
                            class="absolute top-4 right-4 p-2 rounded-full ${theme.textSub} hover:opacity-100 transition-all ${theme.headerIconBg}"
                            title="${state.isAdmin ? 'Logout' : 'Login Admin'}">
                            <i data-lucide="lock" width="16"></i>
                        </button>

                        <div class="relative w-24 h-24 mb-6 group">
                            ${(state.currentTheme === 'techno' || state.currentTheme === 'modern') ? 
                                '<div class="absolute inset-0 bg-blue-500 rounded-full blur opacity-20 group-hover:opacity-40 transition duration-500"></div>' : ''}
                            <div class="relative w-full h-full rounded-full flex items-center justify-center shadow-2xl transition ${theme.headerIconBg}">
                                <span class="font-black text-3xl ${state.currentTheme === 'minimalis' ? 'text-black' : 'text-transparent bg-clip-text bg-gradient-to-tr from-blue-400 to-cyan-300'}">JOI</span>
                            </div>
                        </div>
                        
                        <h1 class="text-3xl font-bold tracking-tight text-center ${theme.textMain}">${state.webTitle}</h1>
                        <div class="flex items-center gap-2 mt-2 px-3 py-1 rounded-full ${theme.headerIconBg}">
                            <i data-lucide="cpu" width="14" class="${theme.accentColor.replace('text-', 'stroke-')}"></i>
                            <p class="text-xs font-mono tracking-wide uppercase ${theme.textSub}">${state.webDesc}</p>
                        </div>
                    </div>

                    <main class="relative z-10 w-full max-w-lg px-6 pb-40 flex flex-col gap-4">
                        
                        ${state.isAdmin ? renderAdminPanel(theme) : ''}

                        ${state.links.length === 0 ? renderEmptyState(theme) : renderLinks(theme)}

                        <div class="mt-8 flex justify-center gap-4 flex-wrap">
                            ${renderSocialIcon('https://facebook.com/budijoiBBJ', 'facebook', 'FB', theme)}
                            ${renderSocialIcon('https://instagram.com/budijoi_eco', 'instagram', 'IG', theme)}
                            ${renderSocialIcon('https://www.threads.net/@budijoi_eco', 'at-sign', 'Threads', theme)}
                            ${renderSocialIcon(`https://wa.me/${CONTACT_WA}`, 'smartphone', 'WA', theme)}
                            ${renderSocialIcon('mailto:premipahe@gmail.com', 'mail', 'Email', theme)}
                        </div>
                    </main>

                    <div class="fixed bottom-6 left-0 right-0 px-6 z-40">
                        <div class="max-w-sm mx-auto p-2 rounded-2xl shadow-2xl flex gap-2 border ${theme.bottomNav}">
                            <button onclick="handlers.setShowSuggestion(true)" class="flex-1 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition text-sm hover:opacity-80">
                                <i data-lucide="message-circle" width="18"></i> Saran
                            </button>
                            <div class="w-px bg-gray-500/30 my-2"></div>
                            <button onclick="handlers.setShowDonation(true)" class="flex-1 py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition text-sm ${theme.btnPrimary}">
                                <i data-lucide="coffee" width="18"></i> Donasi
                            </button>
                        </div>
                    </div>

                    ${state.showWarning ? renderModal('Pemberitahuan', true, 'handlers.setShowWarning(false)', theme, renderWarningContent(theme)) : ''}
                    ${state.linkToDelete ? renderModal('Hapus Link?', true, 'handlers.setLinkToDelete(null)', theme, renderDeleteContent(theme)) : ''}
                    ${state.showLogin ? renderModal('System Login', false, 'handlers.setShowLogin(false)', theme, renderLoginContent(theme)) : ''}
                    ${state.showSuggestion ? renderModal('Kirim Saran', false, 'handlers.setShowSuggestion(false)', theme, renderSuggestionContent(theme)) : ''}
                    ${state.showDonation ? renderModal('Support Donasi', false, 'handlers.setShowDonation(false)', theme, renderDonationContent(theme)) : ''}
                </div>
            `;

            // Initialize Icons
            lucide.createIcons();
            
            // Re-bind Inputs Values (since innerHTML wipes them)
            restoreInputValues();

            // Handle Canvas Animation if Techno Theme
            if (state.currentTheme === 'techno') {
                initCanvas();
            }
        }

        // --- SUB-RENDER FUNCTIONS ---

        function renderAdminPanel(theme) {
            return `
            <div class="p-5 rounded-2xl shadow-lg border flex flex-col gap-4 mb-4 animate-scale-up backdrop-blur-md ${theme.modalBg} ${theme.label === 'Techno' ? 'border-blue-500/30' : 'border-gray-200/50'}">
                
                <div>
                    <h3 class="text-xs font-bold uppercase tracking-wider flex items-center gap-2 mb-3 ${theme.accentColor}">
                        <i data-lucide="palette" width="14"></i> Tema Global
                    </h3>
                    <div class="grid grid-cols-4 gap-2">
                        ${Object.keys(THEMES).map(key => `
                            <button onclick="handlers.changeTheme('${key}')"
                                class="text-xs py-2 px-1 rounded-lg border transition-all ${state.currentTheme === key ? 
                                `${theme.btnPrimary} border-transparent ring-2 ring-offset-2 ring-offset-transparent ring-blue-500` : 
                                `bg-transparent ${theme.textSub} border-gray-500/30 hover:border-gray-500`}">
                                ${THEMES[key].label}
                            </button>
                        `).join('')}
                    </div>
                </div>

                <hr class="border-gray-500/20" />

                <div class="mb-1">
                    <h3 class="text-xs font-bold uppercase tracking-wider flex items-center gap-2 mb-2 ${theme.accentColor}">
                        <i data-lucide="type" width="14"></i> Info Website
                    </h3>
                    <div class="flex flex-col gap-2">
                        <input id="input-webTitle" oninput="handlers.handleInput('webTitle', this.value)" onblur="handlers.handleConfigBlur()"
                            class="border p-2 rounded-lg text-xs outline-none transition bg-black/10 border-gray-500/30 focus:border-blue-500 ${theme.textMain} placeholder-gray-500"
                            placeholder="Nama Website" value="${state.webTitle}" />
                        <input id="input-webDesc" oninput="handlers.handleInput('webDesc', this.value)" onblur="handlers.handleConfigBlur()"
                            class="border p-2 rounded-lg text-xs outline-none transition bg-black/10 border-gray-500/30 focus:border-blue-500 ${theme.textMain} placeholder-gray-500"
                            placeholder="Deskripsi Singkat" value="${state.webDesc}" />
                    </div>
                </div>

                <hr class="border-gray-500/20" />

                <form onsubmit="handlers.handleSaveLink(event)" class="flex flex-col gap-3">
                    <div class="flex justify-between items-center mb-1">
                        <h3 class="text-xs font-bold uppercase tracking-wider flex items-center gap-2 ${state.editingLink ? 'text-yellow-500' : theme.accentColor}">
                            ${state.editingLink ? '<i data-lucide="edit-2" width="14"></i> Edit Link' : '<i data-lucide="layout-grid" width="14"></i> Tambah Link'}
                        </h3>
                        ${state.editingLink ? `
                            <button type="button" onclick="handlers.cancelEdit()" class="text-xs flex items-center gap-1 px-2 py-1 rounded-lg border ${theme.textSub} border-gray-500/50">
                                <i data-lucide="rotate-ccw" width="12"></i> Batal
                            </button>
                        ` : ''}
                    </div>
                    
                    <input id="input-newLinkTitle" oninput="handlers.handleFormInput('newLinkTitle', this.value)"
                        class="border p-3 rounded-xl text-sm outline-none transition bg-black/10 border-gray-500/30 focus:border-blue-500 ${theme.textMain} placeholder-gray-500"
                        placeholder="Judul Link" value="${state.forms.newLinkTitle}" />
                    <input id="input-newLinkDesc" oninput="handlers.handleFormInput('newLinkDesc', this.value)"
                        class="border p-3 rounded-xl text-sm outline-none transition bg-black/10 border-gray-500/30 focus:border-blue-500 ${theme.textMain} placeholder-gray-500"
                        placeholder="Deskripsi Singkat" value="${state.forms.newLinkDesc}" />
                    <input id="input-newLinkUrl" oninput="handlers.handleFormInput('newLinkUrl', this.value)"
                        class="border p-3 rounded-xl text-sm outline-none transition bg-black/10 border-gray-500/30 focus:border-blue-500 ${theme.textMain} placeholder-gray-500"
                        placeholder="URL (https://...)" value="${state.forms.newLinkUrl}" />
                    
                    <button class="py-3 rounded-xl font-bold text-sm transition shadow-lg ${state.editingLink ? 'bg-yellow-600 hover:bg-yellow-500 text-white' : theme.btnPrimary}">
                        ${state.editingLink ? 'Update Link' : 'Simpan Link'}
                    </button>
                </form>
            </div>`;
        }

        function renderLinks(theme) {
            return state.links.map(link => `
                <div class="group relative transition-all duration-300 ${state.editingLink?.id === link.id ? 'opacity-50 scale-95' : ''}">
                    <a href="${link.url}" target="_blank" rel="noreferrer"
                        onclick="${state.editingLink ? 'event.preventDefault()' : ''}"
                        class="flex items-center justify-between p-4 rounded-2xl border transition-all duration-300 ${theme.cardClass}">
                        <div class="flex items-center gap-4 w-full">
                            <div class="w-12 h-12 shrink-0 rounded-xl flex items-center justify-center transition-colors ${theme.iconBg} ${state.currentTheme === 'minimalis' ? '' : 'group-hover:bg-blue-600 group-hover:text-white'}">
                                <i data-lucide="${link.category === 'Web' ? 'globe' : 'network'}" width="20"></i>
                            </div>
                            <div class="min-w-0 flex-1">
                                <h3 class="font-bold text-base truncate ${theme.textMain} ${state.currentTheme === 'minimalis' ? 'group-hover:text-white' : ''}">${link.title}</h3>
                                ${link.description ? 
                                    `<p class="text-xs mt-0.5 line-clamp-2 leading-relaxed ${theme.textSub} ${state.currentTheme === 'minimalis' ? 'group-hover:text-gray-300' : ''}">${link.description}</p>` :
                                    `<p class="text-[10px] uppercase font-mono mt-0.5 tracking-wide opacity-50">Secure Link</p>`
                                }
                            </div>
                        </div>
                        ${!state.isAdmin ? `
                        <div class="transition ml-3 ${theme.textSub} ${state.currentTheme === 'minimalis' ? 'group-hover:text-white' : ''}">
                            <i data-lucide="chevron-right" width="20"></i>
                        </div>` : ''}
                    </a>
                    ${state.isAdmin ? `
                    <div class="absolute right-3 top-1/2 -translate-y-1/2 z-30 flex gap-2" onclick="event.stopPropagation()">
                        <button onclick="handlers.startEdit(${link.id})" class="bg-yellow-500/20 hover:bg-yellow-500 text-yellow-500 hover:text-white p-2.5 rounded-xl transition-all border border-yellow-500/20 hover:border-yellow-500 shadow-lg backdrop-blur-sm">
                            <i data-lucide="edit-2" width="16"></i>
                        </button>
                        <button onclick="handlers.requestDelete(${link.id})" class="bg-red-500/20 hover:bg-red-600 text-red-400 hover:text-white p-2.5 rounded-xl transition-all border border-red-500/20 hover:border-red-500 shadow-lg backdrop-blur-sm">
                            <i data-lucide="trash-2" width="16"></i>
                        </button>
                    </div>` : ''}
                </div>
            `).join('');
        }

        function renderEmptyState(theme) {
            return `
            <div class="text-center py-12 text-sm rounded-2xl border border-dashed ${theme.textSub} border-gray-500/30">
                <i data-lucide="binary" width="24" class="mx-auto mb-2 opacity-50"></i>
                Memuat Link...
            </div>`;
        }

        function renderSocialIcon(href, iconName, label, theme) {
            return `
            <a href="${href}" target="_blank" rel="noreferrer"
                class="w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 hover:scale-110 ${theme.iconBg} hover:bg-blue-600 hover:text-white"
                title="${label}">
                ${iconName === 'at-sign' ? '<span class="font-bold text-lg">@</span>' : `<i data-lucide="${iconName}" width="20"></i>`}
            </a>`;
        }

        function renderModal(title, danger, closeHandler, theme, contentHTML) {
            return `
            <div class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[100] p-4 animate-fade-in">
                <div class="${theme.modalBg} w-full max-w-md shadow-2xl border overflow-hidden relative animate-scale-up ${theme.label === 'Minimalis' ? 'rounded-none' : 'rounded-2xl'}">
                    <div class="flex justify-between items-center p-5 border-b ${theme.label === 'Techno' ? 'border-slate-800' : 'border-gray-200/20'}">
                        <h3 class="text-xl font-bold tracking-tight flex items-center gap-2 ${danger ? 'text-red-500' : theme.accentColor}">
                            <i data-lucide="${danger ? 'alert-triangle' : 'zap'}" width="18"></i> ${title}
                        </h3>
                        <button onclick="${closeHandler}" class="p-2 rounded-full hover:bg-black/10 transition opacity-70 hover:opacity-100">
                            <i data-lucide="x" width="20"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${contentHTML}
                    </div>
                </div>
            </div>`;
        }

        // Modal Contents
        function renderWarningContent(theme) {
            return `
            <div class="text-center">
                <div class="w-16 h-16 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center mx-auto mb-5 border border-red-500/20">
                    <i data-lucide="alert-triangle" width="32"></i>
                </div>
                <p class="mb-6 text-sm leading-relaxed ${theme.textSub}">
                    Aplikasi ini <span class="${theme.textMain} font-bold">100% GRATIS</span>.
                    <br/>Hati-hati terhadap penipuan yang meminta bayaran wajib.
                </p>
                <button onclick="handlers.setShowWarning(false)" class="w-full py-3 rounded-xl font-semibold transition-all active:scale-95 shadow-lg bg-red-600 hover:bg-red-500 text-white">
                    Saya Mengerti
                </button>
            </div>`;
        }

        function renderDeleteContent(theme) {
            return `
            <div class="text-center">
                <p class="mb-6 ${theme.textSub}">
                    Link <span class="font-bold ${theme.textMain}">"${state.linkToDelete.title}"</span> akan dihapus permanen.
                </p>
                <div class="flex gap-3">
                    <button onclick="handlers.setLinkToDelete(null)" class="flex-1 py-3 rounded-xl font-bold border ${theme.textSub} border-gray-500/30">Batal</button>
                    <button onclick="handlers.confirmDelete()" class="flex-1 py-3 rounded-xl font-bold bg-red-600 text-white hover:bg-red-500 shadow-lg">Hapus</button>
                </div>
            </div>`;
        }

        function renderLoginContent(theme) {
            return `
            <form onsubmit="handlers.handleLogin(event)" class="flex flex-col gap-4">
                <div>
                    <label class="text-xs font-mono uppercase block mb-2 ${theme.textSub}">Admin ID</label>
                    <input type="text" id="input-username" oninput="handlers.handleFormInput('username', this.value)" 
                        class="w-full border p-3 rounded-xl outline-none focus:border-blue-500 transition bg-black/10 border-gray-500/30 ${theme.textMain}" value="${state.forms.username}" autoFocus />
                </div>
                <div>
                    <label class="text-xs font-mono uppercase block mb-2 ${theme.textSub}">Passcode</label>
                    <input type="password" id="input-password" oninput="handlers.handleFormInput('password', this.value)" 
                        class="w-full border p-3 rounded-xl outline-none focus:border-blue-500 transition bg-black/10 border-gray-500/30 ${theme.textMain}" value="${state.forms.password}" />
                </div>
                <button class="w-full font-bold py-3 rounded-xl mt-2 ${theme.btnPrimary}">Access Dashboard</button>
            </form>`;
        }

        function renderSuggestionContent(theme) {
            return `
            <p class="text-sm mb-4 ${theme.textSub}">Kirim data saran ke server WhatsApp.</p>
            <form onsubmit="handlers.sendSuggestion(event)" class="flex flex-col gap-3">
                <input placeholder="Nama Anda" id="input-suggName" oninput="handlers.handleFormInput('suggName', this.value)"
                    class="border p-3 rounded-xl outline-none focus:border-green-500 bg-black/10 border-gray-500/30 ${theme.textMain}" value="${state.forms.suggName}" required />
                <textarea placeholder="Pesan saran..." id="input-suggContent" oninput="handlers.handleFormInput('suggContent', this.value)"
                    class="border p-3 rounded-xl h-24 resize-none outline-none focus:border-green-500 bg-black/10 border-gray-500/30 ${theme.textMain}" required>${state.forms.suggContent}</textarea>
                <button class="bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-500 transition flex justify-center gap-2 items-center">
                    <i data-lucide="send" width="18"></i> Kirim
                </button>
            </form>`;
        }

        function renderDonationContent(theme) {
            return `
            <div class="text-center mb-6">
                <p class="text-xs font-bold text-blue-400 bg-blue-500/10 inline-block px-3 py-1 rounded-full mb-3 border border-blue-500/20">DANA</p>
                <div onclick="navigator.clipboard.writeText('${DANA_NUMBER}'); alert('ID Disalin!')" class="p-4 rounded-2xl border border-dashed cursor-pointer transition group border-gray-500/50 hover:border-blue-500">
                    <h2 class="text-2xl font-mono font-bold ${theme.textMain}">${DANA_NUMBER}</h2>
                    <p class="text-xs mt-1 ${theme.textSub}">Tap to Copy</p>
                </div>
            </div>
            <form onsubmit="handlers.sendDonation(event)">
                <label class="text-xs font-mono uppercase block mb-2 ${theme.textSub}">Nominal</label>
                <input type="number" placeholder="Rp 0" id="input-donationAmount" oninput="handlers.handleFormInput('donationAmount', this.value)"
                    class="w-full border p-3 rounded-xl mb-4 outline-none focus:border-blue-500 font-bold bg-black/10 border-gray-500/30 ${theme.textMain}" value="${state.forms.donationAmount}" required />
                <button class="w-full font-bold py-3 rounded-xl flex justify-center gap-2 items-center ${theme.btnPrimary}">
                    <i data-lucide="heart" width="18" class="fill-current"></i> Konfirmasi
                </button>
            </form>`;
        }

        // --- HANDLERS (Global Logic) ---
        window.handlers = {
            toggleAdmin: () => {
                if (state.isAdmin) {
                    state.isAdmin = false;
                    render();
                } else {
                    state.showLogin = true;
                    render();
                }
            },
            setShowLogin: (val) => { state.showLogin = val; render(); },
            setShowWarning: (val) => { state.showWarning = val; render(); },
            setShowSuggestion: (val) => { state.showSuggestion = val; render(); },
            setShowDonation: (val) => { state.showDonation = val; render(); },
            
            handleFormInput: (key, val) => { state.forms[key] = val; },
            handleInput: (key, val) => { state[key] = val; },

            handleLogin: (e) => {
                e.preventDefault();
                if (state.forms.username === 'admin' && state.forms.password === '170884') {
                    state.isAdmin = true;
                    state.showLogin = false;
                    state.forms.username = '';
                    state.forms.password = '';
                    render();
                } else {
                    alert("Username atau Password salah!");
                }
            },

            changeTheme: (themeKey) => {
                state.currentTheme = themeKey;
                render();
                if (isFirebaseActive && state.user) {
                    const configRef = doc(db, 'artifacts', appId, 'public', 'data', 'appSettings', 'config');
                    setDoc(configRef, { currentTheme: themeKey }, { merge: true });
                }
            },

            handleConfigBlur: () => {
                if (isFirebaseActive && state.user) {
                    const configRef = doc(db, 'artifacts', appId, 'public', 'data', 'appSettings', 'config');
                    setDoc(configRef, { webTitle: state.webTitle, webDesc: state.webDesc }, { merge: true });
                }
            },

            handleSaveLink: async (e) => {
                e.preventDefault();
                const { newLinkTitle, newLinkUrl, newLinkDesc } = state.forms;
                if (!newLinkTitle || !newLinkUrl) return;

                let finalUrl = newLinkUrl;
                if (!/^https?:\/\//i.test(finalUrl)) finalUrl = 'https://' + finalUrl;

                let updatedLinks;
                if (state.editingLink) {
                    updatedLinks = state.links.map(link => link.id === state.editingLink.id ? {
                        ...link, title: newLinkTitle, url: finalUrl, description: newLinkDesc
                    } : link);
                    state.editingLink = null;
                } else {
                    const newLink = {
                        id: Date.now(), title: newLinkTitle, url: finalUrl, description: newLinkDesc || '', category: 'Link'
                    };
                    updatedLinks = [...state.links, newLink];
                }

                state.links = updatedLinks;
                // Reset Forms
                state.forms.newLinkTitle = '';
                state.forms.newLinkUrl = '';
                state.forms.newLinkDesc = '';
                
                render();

                // DB Sync
                if (isFirebaseActive && state.user) {
                    const linksRef = doc(db, 'artifacts', appId, 'public', 'data', 'appContent', 'links');
                    await setDoc(linksRef, { items: updatedLinks }, { merge: true });
                }
            },

            startEdit: (id) => {
                const link = state.links.find(l => l.id === id);
                if (link) {
                    state.editingLink = link;
                    state.forms.newLinkTitle = link.title;
                    state.forms.newLinkUrl = link.url;
                    state.forms.newLinkDesc = link.description || '';
                    render();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            },

            cancelEdit: () => {
                state.editingLink = null;
                state.forms.newLinkTitle = '';
                state.forms.newLinkUrl = '';
                state.forms.newLinkDesc = '';
                render();
            },

            requestDelete: (id) => {
                state.linkToDelete = state.links.find(l => l.id === id);
                render();
            },

            setLinkToDelete: (val) => { state.linkToDelete = val; render(); },

            confirmDelete: async () => {
                if (state.linkToDelete) {
                    const updatedLinks = state.links.filter(l => l.id !== state.linkToDelete.id);
                    state.links = updatedLinks;
                    
                    if (state.editingLink && state.editingLink.id === state.linkToDelete.id) {
                        state.editingLink = null;
                        state.forms.newLinkTitle = '';
                        state.forms.newLinkUrl = '';
                        state.forms.newLinkDesc = '';
                    }
                    
                    state.linkToDelete = null;
                    render();

                    if (isFirebaseActive && state.user) {
                        const linksRef = doc(db, 'artifacts', appId, 'public', 'data', 'appContent', 'links');
                        await setDoc(linksRef, { items: updatedLinks }, { merge: true });
                    }
                }
            },

            sendSuggestion: (e) => {
                e.preventDefault();
                if (!state.forms.suggName || !state.forms.suggContent) return;
                const msg = `Halo Admin, saya ${state.forms.suggName}.%0A%0AIsi Saran:%0A${state.forms.suggContent}`;
                window.open(`https://wa.me/${CONTACT_WA}?text=${msg}`, '_blank');
                state.showSuggestion = false;
                render();
            },

            sendDonation: (e) => {
                e.preventDefault();
                if (!state.forms.donationAmount) return;
                const msg = `Halo Admin, saya ingin konfirmasi donasi.%0A%0ANominal: Rp ${state.forms.donationAmount}%0A%0AMohon info selanjutnya.`;
                window.open(`https://wa.me/${CONTACT_WA}?text=${msg}`, '_blank');
                state.showDonation = false;
                render();
            }
        };

        // --- UTILITIES ---
        function restoreInputValues() {
            // Helper to keep focus or values when rerendering
            const ids = ['input-username', 'input-password', 'input-webTitle', 'input-webDesc', 'input-newLinkTitle', 'input-newLinkDesc', 'input-newLinkUrl', 'input-suggName', 'input-suggContent', 'input-donationAmount'];
            
            // Check active element before render
            // Note: In a full VDOM this is automatic, here we just set values. 
            // The logic is handled by binding value={state...} in HTML strings directly.
        }

        // --- CANVAS ANIMATION ---
        let animationFrameId;
        function initCanvas() {
            const canvas = document.getElementById('networkCanvas');
            if (!canvas) return;
            
            // Avoid double init
            if (canvas.dataset.initialized) return;
            canvas.dataset.initialized = "true";

            const ctx = canvas.getContext('2d');
            let particles = [];

            const resizeCanvas = () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            };

            const createParticles = () => {
                const particleCount = Math.min(window.innerWidth / 15, 80);
                particles = [];
                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        size: Math.random() * 2 + 1
                    });
                }
            };

            const draw = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(66, 153, 225, 0.5)';
                ctx.strokeStyle = 'rgba(66, 153, 225, 0.15)';

                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();

                    for (let j = i + 1; j < particles.length; j++) {
                        const p2 = particles[j];
                        const dx = p.x - p2.x;
                        const dy = p.y - p2.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 150) {
                            ctx.beginPath();
                            ctx.moveTo(p.x, p.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.stroke();
                        }
                    }
                });
                animationFrameId = requestAnimationFrame(draw);
            };

            window.addEventListener('resize', () => { resizeCanvas(); createParticles(); });
            resizeCanvas();
            createParticles();
            cancelAnimationFrame(animationFrameId); // Clear old loop
            draw();
        }

        // --- INIT APP ---
        // 1. Render UI Awal
        render();

        // 2. Init Firebase Listener (If Configured)
        if (isFirebaseActive) {
            signInAnonymously(auth).then(() => {
                // Auth Listener
                onAuthStateChanged(auth, (u) => {
                    state.user = u;
                    if (!u) return;

                    // Sync Config
                    const configRef = doc(db, 'artifacts', appId, 'public', 'data', 'appSettings', 'config');
                    onSnapshot(configRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            if (data.webTitle) state.webTitle = data.webTitle;
                            if (data.webDesc) state.webDesc = data.webDesc;
                            if (data.currentTheme && THEMES[data.currentTheme]) {
                                state.currentTheme = data.currentTheme;
                            }
                            render();
                        }
                    });

                    // Sync Links
                    const linksRef = doc(db, 'artifacts', appId, 'public', 'data', 'appContent', 'links');
                    onSnapshot(linksRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const items = docSnap.data().items;
                            state.links = Array.isArray(items) ? items : [];
                        } else {
                            state.links = DEFAULT_LINKS;
                        }
                        render();
                    });
                });
            });
        }

    </script>
</body>
</html>
